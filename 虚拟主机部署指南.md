# 嘉禾云网网站 - 虚拟主机部署指南

## 📋 部署前准备

### 虚拟主机要求

| 项目 | 要求 | 说明 |
|------|------|------|
| PHP版本 | 7.0+ | 推荐7.4或8.0+ |
| Web服务器 | Apache/Nginx | 支持.htaccess或伪静态 |
| 磁盘空间 | 50MB+ | 包含代码和数据文件 |
| 文件权限 | 可写权限 | api.php需要写入权限 |
| 数据库 | 不需要 | 使用JSON文件存储 |

### 需要准备的信息

- ✅ 虚拟主机FTP账号和密码
- ✅ 虚拟主机域名或IP地址
- ✅ 虚拟主机控制面板地址
- ✅ 文件管理器或FTP工具（如FileZilla）

---

## 📦 文件清单

### 必需文件

```
website_deploy/
├── index.html          # 网站首页（1.7KB）
├── api.php             # API接口文件（8.6KB）
├── assets/             # 静态资源目录
│   ├── index-*.js      # JavaScript文件
│   └── index-*.css     # CSS样式文件
├── .htaccess           # Apache配置文件（需创建）
└── 虚拟主机部署指南.md  # 本文档
```

### 运行时生成的文件

```
site_data.json          # 数据存储文件（自动生成）
api_log.txt             # API日志文件（自动生成）
```

---

## 🚀 部署步骤

### 方法一：使用FTP工具上传（推荐）

#### 1. 下载并安装FileZilla
- 官网：https://filezilla-project.org/
- 或使用其他FTP客户端

#### 2. 连接到虚拟主机
```
主机：ftp.yourdomain.com（或虚拟主机提供的FTP地址）
用户名：your_ftp_username
密码：your_ftp_password
端口：21（默认）
```

#### 3. 上传文件
1. 连接成功后，找到网站根目录（通常是 `public_html`、`www` 或 `htdocs`）
2. 将本地 `website_deploy` 目录下的所有文件上传到网站根目录
3. 确保保持目录结构不变

#### 4. 设置文件权限
- 在FTP工具中右键点击根目录
- 选择"文件权限"或"CHMOD"
- 设置目录权限为 `755`（rwxr-xr-x）
- 设置文件权限为 `644`（rw-r--r--）
- 勾选"递归到子目录"

---

### 方法二：使用虚拟主机控制面板

#### 1. 登录控制面板
- 访问虚拟主机提供的控制面板（如cPanel、Plesk等）
- 使用账号密码登录

#### 2. 打开文件管理器
- 找到"文件管理器"或"File Manager"
- 进入网站根目录

#### 3. 上传文件
- 点击"上传"按钮
- 选择本地 `website_deploy` 目录下的所有文件
- 等待上传完成

#### 4. 解压文件（如果打包上传）
- 如果上传的是压缩包，右键选择"解压"
- 确保文件在正确的目录结构中

---

## ⚙️ 配置文件

### 创建 .htaccess 文件（Apache服务器）

在网站根目录创建 `.htaccess` 文件，内容如下：

```apache
# 启用重写引擎
RewriteEngine On

# 设置基础路径
RewriteBase /

# 如果请求的是真实文件或目录，直接访问
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d

# 否则重定向到 index.html（支持React Router）
RewriteRule ^(.*)$ /index.html [L,QSA]

# 设置默认首页
DirectoryIndex index.html

# 启用PHP
<FilesMatch \.php$>
    SetHandler application/x-httpd-php
</FilesMatch>

# 设置字符编码
AddDefaultCharset UTF-8

# 允许跨域访问（如果需要）
<IfModule mod_headers.c>
    Header set Access-Control-Allow-Origin "*"
    Header set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header set Access-Control-Allow-Headers "Content-Type"
</IfModule>

# 压缩静态资源
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# 设置缓存
<IfModule mod_expires.c>
    ExpiresActive On
    ExpiresByType image/jpg "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/gif "access plus 1 year"
    ExpiresByType image/png "access plus 1 year"
    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
</IfModule>
```

### Nginx配置（如果使用Nginx）

如果虚拟主机使用Nginx，需要在控制面板中添加以下配置：

```nginx
location / {
    try_files $uri $uri/ /index.html;
}

location ~ \.php$ {
    fastcgi_pass unix:/var/run/php/php7.4-fpm.sock;
    fastcgi_index index.php;
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
}

location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}
```

---

## ✅ 部署验证

### 1. 访问网站首页
```
http://yourdomain.com/
或
http://your-ip-address/
```

**预期结果**：
- ✅ 显示"嘉禾云网"首页
- ✅ 轮播图正常显示
- ✅ 新闻列表显示默认内容
- ✅ 产品和案例正常显示

### 2. 测试API接口
```
http://yourdomain.com/api.php
```

**预期结果**：
```json
{
  "message": "数据文件不存在，将使用默认配置"
}
```

### 3. 访问后台管理
```
http://yourdomain.com/#/admin
```

**登录信息**：
- 用户名：`admin`
- 密码：`admin`

**预期结果**：
- ✅ 显示登录页面
- ✅ 登录成功后显示管理面板
- ✅ 可以管理新闻、产品、案例

### 4. 测试数据保存
1. 登录后台
2. 添加一条测试新闻
3. 点击"提交并保存至服务器"
4. 刷新前台页面

**预期结果**：
- ✅ 后台显示"云端已同步"
- ✅ 前台显示新添加的新闻
- ✅ 服务器生成 `site_data.json` 文件

---

## 🔧 常见问题解决

### 问题1：页面显示404错误

**原因**：.htaccess文件未生效或配置错误

**解决方案**：
1. 确认虚拟主机支持.htaccess
2. 检查.htaccess文件是否在根目录
3. 确认Apache已启用mod_rewrite模块
4. 联系虚拟主机提供商确认配置

### 问题2：API保存数据失败

**原因**：目录没有写入权限

**解决方案**：
```bash
# 方法1：通过FTP设置权限
右键点击根目录 -> 文件权限 -> 设置为 755

# 方法2：通过控制面板文件管理器
选择根目录 -> 权限 -> 设置为 755

# 方法3：联系虚拟主机提供商
请求设置目录可写权限
```

### 问题3：页面样式丢失

**原因**：静态资源路径错误

**解决方案**：
1. 确认 `assets` 目录已上传
2. 检查 `assets` 目录权限为 755
3. 清除浏览器缓存后重试
4. 检查 `index.html` 中的资源引用路径

### 问题4：后台无法登录

**原因**：JavaScript未正常加载

**解决方案**：
1. 按F12打开浏览器开发者工具
2. 查看Console是否有错误
3. 确认所有JS文件已上传
4. 清除浏览器缓存后重试

### 问题5：中文显示乱码

**原因**：字符编码设置错误

**解决方案**：
1. 确认.htaccess中有 `AddDefaultCharset UTF-8`
2. 确认PHP文件保存为UTF-8编码
3. 在虚拟主机控制面板设置默认字符集为UTF-8

---

## 🔒 安全建议

### 1. 修改默认管理员密码

**重要**：首次部署后立即修改！

修改文件：`assets/index-*.js`（需要重新构建项目）

或者在前端代码 `src/constants.tsx` 中修改：
```typescript
export const DEFAULT_ADMIN = {
  username: 'admin',
  passwordHash: 'your_new_password'  // 修改为新密码
};
```

### 2. 限制API访问

在 `api.php` 文件开头添加：
```php
// 限制访问来源
$allowed_origins = ['yourdomain.com', 'www.yourdomain.com'];
$origin = $_SERVER['HTTP_ORIGIN'] ?? '';
if (!in_array(parse_url($origin, PHP_URL_HOST), $allowed_origins)) {
    http_response_code(403);
    exit('Access denied');
}
```

### 3. 定期备份数据

**重要文件**：
- `site_data.json` - 所有网站数据
- `api_log.txt` - API操作日志

**备份方法**：
1. 通过FTP定期下载这两个文件
2. 或使用虚拟主机控制面板的备份功能
3. 建议每周备份一次

### 4. 监控日志文件

定期查看 `api_log.txt`，检查是否有异常操作：
```
[2026-01-02 13:14:36] [SUCCESS] WRITE - 成功写入 14069 字节
[2026-01-02 13:15:17] [SUCCESS] READ - 成功读取 14069 字节
```

---

## 📊 性能优化

### 1. 启用Gzip压缩

在.htaccess中已包含压缩配置，确保虚拟主机支持mod_deflate模块

### 2. 设置缓存策略

在.htaccess中已包含缓存配置，可根据需要调整缓存时间

### 3. 优化图片

- 使用WebP格式（如果浏览器支持）
- 压缩图片文件大小
- 使用CDN加速图片加载

### 4. 使用CDN

将静态资源（CSS、JS、图片）托管到CDN：
- 阿里云CDN
- 腾讯云CDN
- 七牛云CDN

---

## 📱 移动端适配

网站已支持响应式设计，自动适配手机和平板：

**测试方法**：
1. 在手机浏览器中访问网站
2. 或在电脑浏览器按F12，切换到移动设备模式
3. 确认页面布局正常

---

## 🌐 域名绑定

### 1. 添加域名解析

在域名服务商控制面板添加A记录：
```
类型：A
主机记录：@（或www）
记录值：虚拟主机IP地址
TTL：10分钟
```

### 2. 在虚拟主机绑定域名

在虚拟主机控制面板：
1. 找到"域名管理"或"绑定域名"
2. 添加您的域名
3. 等待DNS生效（通常5-30分钟）

### 3. 配置HTTPS（推荐）

**免费SSL证书**：
- Let's Encrypt（大多数虚拟主机支持一键申请）
- 阿里云免费SSL证书
- 腾讯云免费SSL证书

**配置步骤**：
1. 在虚拟主机控制面板申请SSL证书
2. 绑定到您的域名
3. 开启强制HTTPS跳转

---

## 📞 技术支持

### 遇到问题？

1. **查看日志**：检查 `api_log.txt` 文件
2. **浏览器控制台**：按F12查看错误信息
3. **联系虚拟主机**：咨询技术支持
4. **查看文档**：参考本部署指南

### 联系方式

- **项目GitHub**: https://github.com/JHGanLCH/JHCloud-PHP-MYSQL-0102
- **在线演示**: https://80-i6hyo3il502ped5tn7ze1-57e06be1.sg1.manus.computer/

---

## ✅ 部署检查清单

部署完成后，请逐项检查：

- [ ] 所有文件已上传到虚拟主机
- [ ] 目录权限设置为755
- [ ] 文件权限设置为644
- [ ] .htaccess文件已创建
- [ ] 网站首页可以正常访问
- [ ] API接口返回正确响应
- [ ] 后台管理可以登录
- [ ] 可以添加和保存数据
- [ ] 前台显示最新数据
- [ ] 修改了默认管理员密码
- [ ] 设置了定期备份计划
- [ ] 绑定了域名（如果有）
- [ ] 配置了HTTPS（推荐）

---

## 🎉 部署完成

恭喜！您已成功将嘉禾云网网站部署到虚拟主机。

**下一步**：
1. 修改默认管理员密码
2. 添加真实的公司内容
3. 上传公司图片和资料
4. 配置SEO优化
5. 提交到搜索引擎

祝您使用愉快！

---

**文档版本**：v1.0.0  
**最后更新**：2026-01-02  
**适用环境**：PHP 7.0+ / Apache / Nginx
